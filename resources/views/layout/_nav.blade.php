<div id="nav_container" class="h-30" x-data="{ open: false }"
     style="
        background-image: url('{{ asset('images/bytebeze-banner-tess.png') }} ');
        background-repeat: repeat;"
>
    <div class="container mx-auto px-4">
        <nav class="flex justify-between items-center py-4">
            <div class="w-4/5 sm:w-3/5 md:w-2/5 lg:w-2/5">
                <a href="/">
                    <div id="logo-container">
                        <svg id="joebeze_logo_lazer_anim" data-name="joebeze_logo_lazer_anim" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 523.82 61.68">
                            <defs>
                                <style>
                                    .cls-1 {
                                        fill: transparent;
                                        stroke-width: 0px;
                                    }
                                </style>
                            </defs>
                            <path class="cls-1" d="M27.11,11.14v25.11c0,7.67-4.04,13.23-14.19,13.23H0v-6.7h12.6c6.02,0,7.84-2.9,7.84-6.59V11.14h6.75Z"/>
                            <path class="cls-1" d="M53.64,19.59c7.95,0,13,4.89,13,14.98s-5.05,14.98-13,14.98h-6.3c-8.01,0-13-4.89-13-14.98s5-14.98,13-14.98h6.3Z"/>
                            <path class="cls-1" d="M47.92,25.37c-5.22,0-7.49,2.73-7.49,9.2s2.27,9.15,7.49,9.15h5.17c5.17,0,7.49-2.67,7.49-9.15s-2.33-9.2-7.49-9.2h-5.17Z"/>
                            <path class="cls-1" d="M93.37,19.59c7.09,0,10.11,3.41,10.11,9.2s-2.78,8.63-10.16,8.63H79.06v2.16c0,2.38,1.31,4.15,4.6,4.15h18.34v5.85H83.66c-7.49,0-10.45-4.2-10.45-9.88V29.47c0-5.68,2.95-9.88,10.45-9.88h9.71Z"/>
                            <path class="cls-1" d="M79.09,32.71H93.2c3.24,0,4.43-1.36,4.43-3.58s-1.31-3.75-4.26-3.75H83.69c-3.3,0-4.6,1.82-4.6,4.15v3.18Z"/>
                            <path class="cls-1" d="M116.92,6.59v13h13.28c7.95,0,12.94,4.89,12.94,14.98s-5,14.98-12.94,14.98h-8.29c-7.21,0-11.02-4.2-11.02-12.84V6.59h6.02Z"/>
                            <path class="cls-1" d="M116.92,25.37v11.07c0,5.11,1.88,7.27,6.75,7.27h5.9c5.22,0,7.49-2.67,7.49-9.15s-2.27-9.2-7.49-9.2h-12.66Z"/>
                            <path class="cls-1" d="M169.86,19.59c7.09,0,10.11,3.41,10.11,9.2s-2.78,8.63-10.16,8.63h-14.25v2.16c0,2.38,1.31,4.15,4.6,4.15h18.34v5.85H160.15c-7.49,0-10.45-4.2-10.45-9.88V29.47c0-5.68,2.95-9.88,10.45-9.88h9.71Z"/>
                            <path class="cls-1" d="M155.58,32.71h14.08c3.24,0,4.43-1.36,4.43-3.58s-1.31-3.75-4.26-3.75h-9.65c-3.3,0-4.6,1.82-4.6,4.15v3.18Z"/>
                            <path class="cls-1" d="M206.83,19.59c5.22,0,7.72,2.73,7.72,6.87,0,3.69-1.99,6.08-5.11,7.21L192.27,40c-1.02.4-1.59,1.08-1.59,2.05,0,1.14.74,1.82,2.27,1.82h21.01v5.79H192.9c-5.17,0-7.72-2.73-7.72-6.87,0-3.35,1.65-6.02,5.11-7.27l17.25-6.19c1.25-.45,1.59-1.31,1.59-2.1,0-1.14-.74-1.76-2.33-1.76h-20.56v-5.79h20.9Z"/>
                            <path class="cls-1" d="M240.64,19.59c7.09,0,10.11,3.41,10.11,9.2s-2.78,8.63-10.16,8.63h-14.25v2.16c0,2.38,1.31,4.15,4.6,4.15h18.34v5.85H230.93c-7.49,0-10.45-4.2-10.45-9.88V29.47c0-5.68,2.95-9.88,10.45-9.88h9.71Z"/>
                            <path class="cls-1" d="M226.36,32.71h14.08c3.24,0,4.43-1.36,4.43-3.58s-1.31-3.75-4.26-3.75h-9.65c-3.3,0-4.6,1.82-4.6,4.15v3.18Z"/>
                            <path class="cls-1" d="M304.1,6.59v30.15c0,8.63-3.86,12.84-11.02,12.84h-8.29c-8.01,0-13-4.89-13-14.98s5-14.98,13-14.98h13.23V6.59h6.08Z"/>
                            <path class="cls-1" d="M298.02,36.46V25.37H285.36c-5.17,0-7.49,2.73-7.49,9.2s2.33,9.15,7.49,9.15h5.96c4.83,0,6.7-2.16,6.7-7.27Z"/>
                            <path class="cls-1" d="M332.25,19.59c7.09,0,10.11,3.41,10.11,9.2s-2.78,8.63-10.16,8.63H317.95v2.16c0,2.38,1.31,4.15,4.6,4.15h18.34v5.85H322.54c-7.49,0-10.45-4.2-10.45-9.88V29.47c0-5.68,2.95-9.88,10.45-9.88h9.71Z"/>
                            <path class="cls-1" d="M317.97,32.71h14.08c3.24,0,4.43-1.36,4.43-3.58s-1.31-3.75-4.26-3.75h-9.65c-3.3,0-4.6,1.82-4.6,4.15v3.18Z"/>
                            <path class="cls-1" d="M351.88,19.59,361.88,43.66c.23.63.74.91,1.48.91.79,0,1.31-.28,1.59-.91l10.39-24.08h6.47L370.22,46.33c-1.25,2.84-3.47,3.92-6.87,3.92s-5.68-1.14-6.81-3.92L345.64,19.59h6.36Z"/>
                            <path class="cls-1" d="M408.17,6.59v13h13.28c7.95,0,12.94,4.89,12.94,14.98s-5,14.98-12.94,14.98h-8.29c-7.21,0-11.02-4.2-11.02-12.84V6.59h6.02Z"/>
                            <path class="cls-1" d="M408.17,25.37v11.07c0,5.11,1.88,7.27,6.75,7.27h5.9c5.22,0,7.49-2.67,7.49-9.15s-2.27-9.2-7.49-9.2h-12.66Z"/>
                            <path class="cls-1" d="M447.56,6.59V49.58h-6.02V6.59h6.02Z"/>
                            <path class="cls-1" d="M474.07,19.59c7.95,0,13,4.89,13,14.98s-5.05,14.98-13,14.98H467.8c-8.01,0-13-4.89-13-14.98s5-14.98,13-14.98h6.3Z"/>
                            <path class="cls-1" d="M468.36,25.37c-5.22,0-7.49,2.73-7.49,9.2s2.27,9.15,7.49,9.15h5.17c5.17,0,7.49-2.67,7.49-9.15s-2.33-9.2-7.49-9.2h-5.17Z"/>
                            <path class="cls-1" d="M514.03,19.59c7.15,0,11.02,4.2,11.02,12.84v17.25c0,8.52-2.95,11.87-11.36,11.87H495.86V55.76h17.14c4.49,0,5.96-1.76,5.96-6.08V48.32H505.68c-8.01,0-13-4.72-13-14.42s5-14.3,13-14.3h8.29Z"/>
                            <path class="cls-1" d="M506.26,42.92h12.66V32.41c0-4.89-1.88-6.99-6.7-6.99h-5.96c-5.17,0-7.49,2.61-7.49,8.75s2.33,8.75,7.49,8.75Z"/>
                        </svg>
                        <svg id="joebeze_logo_filled" data-name="joebeze_logo_filled" xmlns="http://www.w3.org/2000/svg"
                             viewBox="0 0 523.82 61.68">
                            <defs>
                                <style>
                                    .cls-2-1 {
                                        fill: #fff;
                                        font-family: NasalizationRg-Regular, Nasalization;
                                        font-size: 56px;
                                    }

                                    .cls-2-2 {
                                        letter-spacing: -.01em;
                                    }

                                    .cls-2-3 {
                                        letter-spacing: -.02em;
                                    }

                                    .cls-2-4 {
                                        letter-spacing: -.02em;
                                    }
                                </style>
                            </defs>
                            <text class="cls-2-1" transform="translate(0 46.9)">
                                <tspan x="0" y="0">Joeb</tspan>
                                <tspan class="cls-2-3" x="145.65" y="0">e</tspan>
                                <tspan class="cls-2-2" x="181.1" y="0">z</tspan>
                                <tspan x="215.37" y="0">e d</tspan>
                                <tspan class="cls-2-4" x="305.76" y="0">e</tspan>
                                <tspan x="341.26" y="0">v blog</tspan>
                            </text>
                        </svg>

                        <canvas id="canvas" width="518" height="54"></canvas>
                        <canvas id="canvas2" width="518" height="54"></canvas>
                    </div>

                </a>
            </div>
            <div class="hidden lg:flex xl:w-2/5 lg:w-0/5 items-center justify-center">
            </div>
            <div class="hidden lg:flex lg:w-3/5 justify-end">
                <div
                    class="w-2/5 relative flex lg:inline-flex mr-10 lg:mr-5 bg-white text-gray-800 border-2 border-gray-800 hover:border-gray-500 rounded-md">
                    <x-categories.dropdown :post="$post ?? null"/>
                </div>
                <div x-data="{ search: '{{ request('search') }}', category: '{{ request('category') }}' }">
                    <form method="GET" action="#" x-ref="form">
                        @if (request('category'))
                            <input type="hidden" name="category" value="{{ request('category') }}">
                        @endif
                        <input type="search"
                               name="search"
                               placeholder="Search"
                               class="border-2 border-gray-800 w-full rounded-md p-2 bg-white text-gray-800"
                               x-model="search"
                               x-on:search="if (!search) $refs.form.submit()"
                               value="{{ request('search') }}"
                        >
                    </form>
                </div>
            </div>
            <div class="lg:hidden w-1/5 flex items-center justify-center">
                <button @click="open = !open"
                        class="border border-white rounded-md p-2 bg-gray-800 inline-block cursor-pointer">
                    <svg class="fill-current text-white h-6 w-6" viewBox="0 0 24 24">
                        <path x-show="!open" fill-rule="evenodd" clip-rule="evenodd"
                              d="M4 5h16a1 1 0 010 2H4a1 1 0 110-2zm0 6h16a1 1 0 010 2H4a1 1 0 010-2zm0 6h16a1 1 0 010 2H4a1 1 0 010-2z"/>
                        <path x-show="open" fill-rule="evenodd" clip-rule="evenodd"
                              d="M12.707 17.707a1 1 0 01-1.414 0l-5-5a1 1 0 011.414-1.414L12 14.586l4.293-4.293a1 1 0 111.414 1.414l-5 5z"/>
                    </svg>
                </button>
            </div>
        </nav>

        <div x-show="open" class="lg:hidden">
            <div class="lg:border-t border-gray-700 pt-4 flex mb-2">
                <div
                    class="w-2/5 relative flex lg:inline-flex mr-10 lg:mr-5 bg-white text-gray-800 border-2 border-gray-800 hover:border-gray-500 rounded-md">
                    <x-categories.dropdown :post="$post ?? null"/>
                </div>
                <div
                    class="w-2/5 relative flex lg:inline-flex mr-10 lg:mr-5 bg-white text-gray-800 border-2 border-gray-800 hover:border-gray-500 rounded-md">
                    <form class="w-full" method="GET" action="#">
                        @if (request('category'))
                            <input type="hidden" name="category" value="{{ request('category') }}">
                        @endif
                        <input type="text"
                               name="search"
                               placeholder="Search"
                               class="w-full rounded-md p-2 bg-white text-gray-800"
                               value="{{ request('search') }}"
                        >
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        class Particle {
            constructor(x, y, size) {
                this.speed = 0.6;
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * this.speed;
                this.vy = (Math.random() - 0.5) * this.speed;
                this.opacity = 1;
                this.size = size;
            }

            draw(context) {
                this.opacity -= this.speed / 200;
                context.fillStyle = `rgba(0, 255, 0, ${this.opacity})`;
                context.fillRect(this.x, this.y, this.size, this.size);
            }

            move() {
                this.x += this.vx;
                this.y += this.vy + (1 - this.opacity) * this.speed;
            }
        }

        class Laser {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.steps = [];
                this.particles = [];
            }

            drawTo(x, y, ctx) {
                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.fillStyle = "red";
                ctx.fillRect(x - 2.5, y - 2.5, 5, 5); // Adjust the position of the dot
            }

            drawEnd(ctx) {
                var p = this.steps.shift();
                if (p !== undefined) {
                    this.drawTo(p[0], p[1], ctx);
                } else {
                    var index = this.particles.length;
                    while (index--) {
                        var p = this.particles[index];
                        p.move();
                        if (p.opacity < 0 || p.x < 0 || p.x > ctx.canvas.width || p.y < 0 || p.y > ctx.canvas.height) {
                            this.particles.splice(index, 1);
                        } else {
                            p.draw(ctx);
                        }
                    }
                }
            }

            endFrom(x0, y0) {
                var nrOfSteps = 800;
                var i = nrOfSteps;
                while (i--) {
                    var x = this.x + i * (x0 - this.x) / nrOfSteps + Math.cos(i / 10) * i / 4;
                    var y = this.y + i * (y0 - this.y) / nrOfSteps + Math.sin(i / 10) * i / 4;
                    this.steps.push([x, y]);
                    if (i < 100) {
                        this.particles.push(new Particle(x, y, 2));
                    }
                }
            }
        }

        class LaserWriter {
            constructor(canvasId, canvas2Id, svgId) {
                var canvas = document.getElementById(canvasId);
                var canvas2 = document.getElementById(canvas2Id);
                this.svg = document.getElementById(svgId);
                this.ctx = canvas.getContext("2d");
                this.ctx2 = canvas2.getContext("2d");
                this.tick = 0;
                this.pathIndex = 0;
                this.pointIndex = 0;
                this.paths = [];
                this.size = 3;
                this.initCanvasSize();
            }

            initCanvasSize() {
                const viewBox = this.svg.viewBox.baseVal;
                const scaleFactor = window.devicePixelRatio || 1; // Adjust for high-density displays

                this.w = viewBox.width * scaleFactor;
                this.h = viewBox.height * scaleFactor;

                this.ctx.canvas.width = this.w;
                this.ctx.canvas.height = this.h;
                this.ctx2.canvas.width = this.w;
                this.ctx2.canvas.height = this.h;

                // Get the SVG logo container element
                const logoContainer = this.svg.parentNode;

                // Set the canvases' positions and dimensions to match the SVG logo
                this.ctx.canvas.style.position = 'absolute';
                this.ctx.canvas.style.left = `${logoContainer.offsetLeft}px`;
                this.ctx.canvas.style.top = `${logoContainer.offsetTop}px`;
                this.ctx.canvas.style.width = `${logoContainer.offsetWidth}px`;
                this.ctx.canvas.style.height = `${logoContainer.offsetHeight}px`;

                this.ctx2.canvas.style.position = 'absolute';
                this.ctx2.canvas.style.left = `${logoContainer.offsetLeft}px`;
                this.ctx2.canvas.style.top = `${logoContainer.offsetTop}px`;
                this.ctx2.canvas.style.width = `${logoContainer.offsetWidth}px`;
                this.ctx2.canvas.style.height = `${logoContainer.offsetHeight}px`;
            }

            init(text, size) {
                // Set font size for the text
                this.ctx.font = `${size}px nasalisation`;
                // Calculate starting X position to center the text
                this.startX = (this.w - this.ctx.measureText(text).width) / 2;
                // Draw text onto the canvas
                this.ctx.fillText(text, this.startX, 100);

                // Get the imageData of the text
                var image = this.ctx.getImageData(0, 0, this.w, this.h);
                var buffer32 = new Uint32Array(image.data.buffer);

                // Clear the canvas after getting the image data
                this.ctx.clearRect(0, 0, this.w, this.h);

                // Set the laser beam styles
                this.ctx2.strokeStyle = "rgba(20, 255, 70, 1)";
                this.ctx2.lineCap = "round";
                this.ctx2.lineWidth = 4;

                // Find the top-left non-zero pixel to set the laser start position
                let startX = this.w, startY = this.h; // Initialize with max values
                for (let y = 0; y < this.h; y++) {
                    for (let x = 0; x < this.w; x++) {
                        if (buffer32[y * this.w + x]) {
                            startX = Math.min(startX, x);
                            startY = Math.min(startY, y);
                        }
                    }
                }

                // Initialize the laser at the top-left of the text
                this.laserStart.x = startX;
                this.laserStart.y = startY;
                this.laser = new Laser(this.laserStart.x, this.laserStart.y);

                // Iterate over every pixel to find where the text is drawn
                for (var y = 0; y < this.h; y++) {
                    for (var x = 0; x < this.w; x++) {
                        if (buffer32[y * this.w + x]) {
                            this.points.push([x, y]);
                        }
                    }
                }
            }

            draw() {
                this.ctx2.clearRect(0, 0, this.w, this.h);

                if (this.pathIndex < this.paths.length) {
                    const path = this.paths[this.pathIndex];
                    const p = path.points[this.pointIndex];

                    if (p) {
                        this.x = p[0];
                        this.y = p[1];
                        this.laser.drawTo(this.x, this.y, this.ctx2);

                        const segmentLength = path.path.getTotalLength() / path.points.length;
                        const distance = this.pointIndex * segmentLength;
                        path.path.style.strokeDasharray = `${distance} ${path.path.getTotalLength()}`;
                        path.path.style.stroke = '#fff';
                        path.path.style.strokeWidth = '2px';
                    }

                    if (this.pointIndex === path.points.length - 1) { // lucky coincidence, skipped to end.
                        this.pathIndex++;
                        this.pointIndex = 0;
                    } else if (this.pointIndex > path.points.length) { // skipped too far, go back to last of path
                        this.pointIndex = path.points.length - 1;
                    } else { // only skip ahead when possible
                        this.pointIndex += 2.5;
                    }
                } else if (this.pathIndex === this.paths.length) {
                    this.laser.endFrom(this.x, this.y);
                    // First operation: fill paths with white
                    this.paths.forEach(path => {
                        path.path.classList.add('drawing-path'); // Ensure your paths have this class
                        path.path.style.fill = 'white'; // This will trigger the transition
                    });

                    // First operation: initiate the transition to a pattern fill after a 2-second delay
                    setTimeout(() => {
                        const defs = this.svg.querySelector('defs') || this.svg.insertBefore(document.createElementNS('http://www.w3.org/2000/svg', 'defs'), this.svg.firstChild);
                        const pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
                        const image = document.createElementNS('http://www.w3.org/2000/svg', 'image');

                        pattern.setAttribute('id', 'imagePattern');
                        pattern.setAttribute('patternUnits', 'userSpaceOnUse');
                        pattern.setAttribute('width', this.svg.clientWidth);
                        pattern.setAttribute('height', this.svg.clientHeight);

                        image.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '{{ asset('images/Screenshot 2024-03-23 100050.png') }}');
                        image.setAttribute('width', this.svg.clientWidth);
                        image.setAttribute('height', this.svg.clientHeight);

                        pattern.appendChild(image);
                        defs.appendChild(pattern);

                        this.paths.forEach(path => {
                            path.path.style.fill = 'url(#imagePattern)';
                        });
                    }, 2000);  // Delay of 2000 milliseconds (2 seconds)


                    this.pathIndex++; // Ensure we don't keep setting the fill repeatedly
                } else {
                    this.laser.drawEnd(this.ctx2);
                }

                if (this.pathIndex <= this.paths.length) {
                    requestAnimationFrame(() => this.draw());
                }
            }

            traceSVG() {
                const paths = this.svg.querySelectorAll('path');
                paths.forEach(path => {
                    path.style.stroke = 'transparent';
                    path.style.fill = 'transparent'; // Set initial fill to transparent
                    const pathPoints = [];
                    const length = path.getTotalLength();
                    const numPoints = Math.floor(length); // Increase the number of points
                    for (let i = 0; i < numPoints; i++) {
                        const point = path.getPointAtLength(i * length / (numPoints - 1));
                        pathPoints.push([point.x, point.y]);
                    }
                    this.paths.push({path, points: pathPoints});
                });

                this.laser = new Laser(this.paths[0].points[0][0], this.paths[0].points[0][1]);
            }
        }
        // delay til page load
        document.addEventListener("DOMContentLoaded", () => {
            // hide the logo after a delay to show the fade effect
            document.getElementById('joebeze_logo_filled').style.animation = 'fadeOut 8s forwards';
            // show show anim

            setTimeout(() => {
                document.getElementById('joebeze_logo_filled').style.display = 'none';
                document.getElementById('joebeze_logo_lazer_anim').style.visibility = 'visible';
                document.getElementById('joebeze_logo_lazer_anim').style.display = 'block';
                const laserWriter = new LaserWriter("canvas", "canvas2", "joebeze_logo_lazer_anim");
                laserWriter.traceSVG();
                laserWriter.draw();
            }, 8000); // Starts the fade-out after 2 seconds



        });
    </script>

    <style>

        #logo-container canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        #joebeze_logo_lazer_anim {
            display: none; /* Start with the element hidden */
            visibility: hidden; /* Start with the element hidden */
            opacity: 0;  /* Start fully transparent */
            animation: fadeIn 2s forwards; /* Animation to fade in */
        }

        @keyframes fadeIn {
            0% {
                opacity: 0;
                visibility: hidden;
            }
            100% {
                opacity: 1;
                visibility: visible;
            }
        }
        /* add a animation transition os 2s*/
        #joebeze_logo_filled {
            /* Ensure the element is visible before the animation */
            visibility: visible;
            opacity: 1;
            animation: fadeOut 2s forwards;
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                visibility: visible;
            }
            100% {
                opacity: 0;
                visibility: hidden;
            }
        }
    </style>

</div>

